<html>
<head>
<!-- Latest compiled and minified CSS -->
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/css/bootstrap.min.css">

<!-- Optional theme -->
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/css/bootstrap-theme.min.css">
<style>
#md-submit {
    width: 100%;
  background-image: -webkit-linear-gradient(top,dodgerblue 35%,#206da4 100%);
  background-image: -webkit-gradient(top,dodgerblue 35%,#206da4 100%);
  background-image: -moz-linear-gradient(top,dodgerblue 35%,#206da4 100%);
  background-image: linear-gradient(top,dodgerblue 35%,#206da4 100%);
} 
body {
    padding-top: 70px;
} 
.navbar {
  background-image: -webkit-linear-gradient(right,#FFA6C9 5%, dodgerblue 100%);
  background-image: -moz-linear-gradient(right,#FFA6C9 5%, dodgerblue 100%);
  background-image: -webkit-gradient(right,#FFA6C9 5%, dodgerblue 100%);
  background-image: linear-gradient(right,#FFA6C9 5%, dodgerblue, 100%);
} 
.navbar-fixed-top {
  border-width: 0; 
} 
.navbar-inverse .navbar-brand {
    color: #fff;
    text-shadow: 0;
    /*color: #000;*/
} 
.navbar-inverse .navbar-toggle  {
  border: 2px solid white; 
}
button.navbar-toggle.collapsed:hover {
  background-color: dodgerblue;
}
button.navbar-toggle.collapsed:focus {
  background-color: dodgerblue;
}
.panel-heading.md-block {
  background-image: -webkit-linear-gradient(top,dodgerblue 35%,#206da4 100%);
  background-image: -webkit-gradient(top,dodgerblue 35%,#206da4 100%);
  background-image: -moz-linear-gradient(top,dodgerblue 35%,#206da4 100%);
  background-image: linear-gradient(top,dodgerblue 35%,#206da4 100%);
} 
.panel-primary>.panel-heading {
    background-color: rgba(0, 117, 254, 0.2);
} 
.panel-primary {
  background-image: -webkit-linear-gradient(top,#EBC17F 65%, #FFA6C9 100%);
  background-image: -moz-linear-gradient(top,#EBC17F 65%, #FFA6C9 100%);
  background-image: -webkit-gradient(top,#EBC17F 65%, #FFA6C9 100%);
  background-image: linear-gradient(top,#EBC17F 66%, #FFA6C9 100%);
  border-width: 1px;
  border-color: lightgrey;
}
.sr-only {
  border: 2px solid white;
}
</style>

    <title>
        NKN Metadata Editor
    </title>
</head>
    

<body cz-shortcut-listen="true">

<nav class="navbar navbar-inverse navbar-fixed-top">
    <div class="container">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="#">Northwest Knowledge Network Metadata Editor</a>
        </div>
    </div>     
</nav>

<!--Handlebars will fill in the details here -->
<form id="mdform" class="form-horizontal" method="post">
  <div id="form-main" class="container">
  </div>
</form>


<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js">
    </script>
<!-- Latest compiled and minified JavaScript -->
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/js/bootstrap.min.js"></script>

<script src='handlebars-v3.0.0.js'></script>

<script id="entry-template" type="text/x-handlebars-template">
    {{#each this}}
<div class="panel-group" id="accordion-{{blockLabel}}" role="tablist"
     aria-multiselectable="true">
  <div class="panel panel-primary">
    <div class="panel-heading md-block" role="tab" id="heading-{{blockLabel}}">
        <h4 class="panel-title">
            <a data-toggle="collapse" data-parent="#accordion-{{blockLabel}}"
               href="#body-{{blockLabel}}" 
               aria-controls="body-{{blockLabel}}" aria-expanded="{{expanded}}">
            {{blockTitle}}
            </a>
        </h4>
    </div>
    <div id="body-{{blockLabel}}" class="panel-collapse collapse in"
         aria-labelledby="heading-{{blockLabel}}" role="tabpanel"
         >
        <div class="panel-body">


    {{#formElements}}


        <div class="form-group">
            <label for="{{label}}" class="control-label col-sm-3">{{label}}</label>
            <div class="col-sm-9">
                
                        <input type='{{type}}' class="form-control" 
                          placeholder='{{value}}' value='{{value}}'
                          id="{{label}}" name="{{name}}"/>
            </div>
        </div>
    
        <div class="row">
            <div class="col-sm-3"></div>
            <div class="col-sm-9">
                {{longDescription}}
            </div>
        </div>
        <br />

    {{/formElements}}

        </div>

      </div>

  </div>
    <br/>
    {{/each}}
</div>
        <input type="submit" value='Submit' id="md-submit" class="btn btn-primary btn-lg"/>
</div>
</script>

<script>
  var source = $("#entry-template").html();

  var template = Handlebars.compile(source);

  // this is a stand-in for data from metadata server
  var context = [];

  // URL of the metadata server
  var url = "http://localhost:4000/api/metadata";

  // md server's GET method returns default md form and autopop values
  $.get(url, function(viewData) {
    console.log(JSON.stringify(viewData.form[0]));
    var html = template(viewData.form);

    $("#form-main").html(html);
  });

// attach a listener on submit button; POST form data to md server on submit
  $('#mdform').submit( function(event) {

    event.preventDefault();

    console.log('up in here');

    // $(this).serialize() gets read as request.form data in Flask
    var posting = $.post(url, $(this).serialize());

    console.log(posting);

    posting.done(function(viewData) {
      console.log(viewData);
      var html = template(viewData.form);
      $("#form-main").html(html);
    });
    console.log("here");
    $('#mdform').trigger("reset");
  });
</script>
</body>
</html>
